<!DOCTYPE html>
<title>はじめてのVue.js</title>
<script src="https://unpkg.com/vue@2.5.17"></script>

<div id="app">
  <h1>
    {{ title }}
  </h1>
　<input type="radio" name="picked" value="all" v-model="picked"　@click="filterTodo('all')">すべて</input>
  <input type="radio" name="picked" value="progress" v-model="picked" @click="filterTodo('inProgress')">作業中</input>
  <input type="radio" name="picked" value="done" v-model="picked" @click="filterTodo('done')">完了</input>
  <table>
    <colgroup>
      <col style="width: 70px;"/>
      <col style="width: 70px;"/>
      <col style="width: 100px;"/>
    </colgroup>
    <thead>
      <tr>
        <th><div>id</div></th>
        <th><div>コメント</div></th>
        <th><div>状態</div></th>
      </tr>
    </thead>
    <tbody>
　　<tr id="todo" v-for="todo in todoListSet" v-show=todo.visible v-if=todo.remain v-bind:key=todo.id>
　　  <td>{{ todo.id }}</td>
　　  <td>{{ todo.comment }}</td>
　　  <td :style="buttonWrapper">
  　　  <button @click="toggleCondition($event)">{{ todo.condition }}</button>
       <button :style="deleteButton" @click="deleteTodo($event)">削除</button>
     </td>
　　</tr>
  </table>
  <h2>新規タスクの追加</h2>


 <input type="text" v-model="input">
 <button @click="addTodo($event)">追加</button>

</div>
<script>
var todoListSet = [];
new Vue({
  el: '#app',
  data: {
    title: 'ToDoリスト',
    todoListSet: todoListSet,
    input: "",
    buttonWrapper: {
      display: 'flex'
    },
    deleteButton: {
      margin: '0px 0px 0px 5px'
    },
    picked: 'all'
  },
  methods: {
    addTodo: function($event) {
      todoListSet.push({
                        id: this.todoListSet.length + 1,
                        comment: this.input,
                        condition: '作業中',
                        remain: true,
                        visible: true
                      });
      this.input="";
    },
    toggleCondition: function($event){
      var target = $event.target.parentNode.parentNode;
      var todoId = target.getElementsByTagName("td")[0].textContent;
      var targetTodo = this.todoListSet.find((todo) => todo.id === parseInt(todoId, 10));
      if( $event.target.innerHTML === '作業中') {
        targetTodo.condition = '完了';
      } else {
        targetTodo.condition = '作業中';
      }

    },
    deleteTodo: function($event) {
　　   var target = $event.target.parentNode.parentNode;
      var todoId = target.getElementsByTagName("td")[0].textContent;
      var targetTodo = this.todoListSet.find((todo) => todo.id === parseInt(todoId, 10));
      targetTodo.remain = false;
    },
    filterTodo: function(filterCondition) {
      var inProgress = this.todoListSet.filter(function(value) {
        return value.condition ==='作業中';
      });
      var done = this.todoListSet.filter(function(value) {
        return value.condition ==='完了';
      });

      if (filterCondition === 'inProgress') {
        inProgress.forEach(function(value) {
          value.visible = true;
        });
        done.forEach(function(value) {
          value.visible = false;
        });
      } else if (filterCondition === 'done') {
        inProgress.forEach(function(value) {
          value.visible = false;
        });
        done.forEach(function(value) {
          value.visible = true;
        });
      } else {
        this.todoListSet.forEach(function(value) {
          value.visible = true;
        })
      }
    }
  }
});
</script>
